# Data report on Population Prescribed Drug

This document was written by Irina Laidvee for data project (PU5058)

The data for the project was used form "Scottish Public Health Observatory" website via the ScotPHO Online Profiles tool access. The Rank tab was used to compare geographical variation for an indicator. First "Population prescribed drug for anxiety/depression/psychosis" was chosen for an indicator, then all Health Boards within Scotland were selected for geography level and compared by time. Areas were compared to each other over time since 2010/11 as a baseline year to 2021/22.

### First, we load all packages and load the raw data.

```{r}
library(readr)
library(tidyr)
library(dplyr)
library(here)
library(tidyverse)
```

Then we open downloaded rank_data file in csv from the website.

```{r}
rank_data_Inputs <- read_csv(here("Inputs/rank_data.csv"))
```

This shows that we have 14 rows for each Health Board and 14 columns with variables and observations. A tidy dataset has to contain only 1 observation per row.

### Cleaning the dataset.

1.  *Remove unnecessary columns.* We can remove indicator and data_source, as we already mentioned this at the beginning of the file. We remove area_type column as it is the same for all rows. We will not be using lower and upper confidence_intervals in our data visualization. We remove the period column as it indicates the same information as year column. The measure column indicates the value for the 2021 year, therefore it can be omitted. Comparator_name repeats the area_name and the value definition can be omitted as well, as it is the same across all boards. In the code we will specify the index position of each column that needs to be removed. The new dataset will be saved as a new file.

```{r}
rank_data_NEW = rank_data_Inputs[, -c(1, 4, 5, 6, 9, 10, 12, 13, 14)]
view(rank_data_NEW)
write_csv(rank_data_NEW, "rank_data_NEW.csv")
```

2.  *Change columns' name.* As it saved new csv file with Data project.rmd in methods, it has been moved from Methods file to Inputs. Read the new file from inputs, just to check that it is in working condition. Also, here we will change the names of some columns. measure -\> 2021, comparator_value -\> 2010

```{r}
rank_data_NEW <- read_csv(here("Inputs/rank_data_NEW.csv"))
colnames(rank_data_NEW)[colnames(rank_data_NEW) %in% c("measure", "comparator_value")] <- c("2021", "2010")
```

3.  *Separate data sets.* We have area_name and area_code as an identification for each row. In a clean data set this should be separate. Therefore, we have created a separate csv file containing geographical identification, moved this file to outputs, as this is a complete file and will not be used for data analysis. We remove area_code from Table_data and pivot the table longer. Ne table will be saved as Tidy_table_data in outputs folder.

```{r}
ID_rank_data <- rank_data_NEW[, c("area_name", "area_code")]
write_csv(ID_rank_data, "ID_rank_data.csv")
Table_data <- rank_data_NEW [, -c(2)]
Tidy_table_data <- Table_data %>% 
  pivot_longer(
    c("2021", "2010"),
    names_to = "year",
    values_to = "percentage"
  )
write_csv(Tidy_table_data, "Tidy_table_data.csv")
```
